{% extends layout_path %}
{% load static %}
{% load i18n %}

{% block title %}Teacher Dashboard{% endblock %}

{% block vendor_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'vendor/libs/apex-charts/apex-charts.css' %}"/>
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/apex-charts/apexcharts.js' %}"></script>
{% endblock vendor_js %}

{% block content %}
<div class="row">
  <!-- Welcome / Summary -->
  <div class="col-12 mb-6">
    <div class="card shadow-sm">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <h4 class="text-primary mb-2"> Welcome back, {{ request.user.username }}!</h4>
          <p class="mb-0 text-muted">Manage your uploaded courses and track student materials.</p>
        </div>
        <img src="{% static 'img/illustrations/man-with-laptop.png' %}" alt="Teacher" height="130"/>
      </div>
    </div>
  </div>

  <!-- Quick stats -->
  <div class="col-md-4 mb-4">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="avatar mb-3 bg-label-primary p-3 rounded">
          <i class="bx bx-book icon-lg text-primary"></i>
        </div>
        <h5 class="mb-1">{{ total_resources }}</h5>
        <p class="text-muted mb-0">Total Resources</p>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-4">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="avatar mb-3 bg-label-success p-3 rounded">
          <i class="bx bx-file icon-lg text-success"></i>
        </div>
        <h5 class="mb-1">
          {{ resource_types_count }}
        </h5>
        <p class="text-muted mb-0">Different Resource Types</p>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-4">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="avatar mb-3 bg-label-warning p-3 rounded">
          <i class="bx bx-notepad icon-lg text-warning"></i>
        </div>
        <h5 class="mb-1">{{ available_quizzes }}</h5>
        <p class="text-muted mb-2">Quiz generes</p>
        <a href="{% url 'quiz:list' %}" class="btn btn-outline-primary w-100">Voir les quiz</a>
      </div>
    </div>
  </div>
</div>

<!-- Resource list -->
<div class="card mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0"> Your Courses & Materials</h5>
    <a href="{% url 'resources:list' %}" class="btn btn-sm btn-primary">
      <i class="bx bx-edit"></i> Back-Office
    </a>
  </div>
  <div class="table-responsive text-nowrap">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Title</th>
          <th>Type</th>
          <th>Tags</th>
          <th>Date</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in resources %}
        <tr>
          <td><strong>{{ r.title }}</strong></td>
          <td>{{ r.resource_type }}</td>
          <td>
            {% for tag in r.tags %}
              <span class="badge bg-label-info me-1">{{ tag }}</span>
            {% empty %}
              <span class="text-muted">No tags</span>
            {% endfor %}
          </td>
          <td>{{ r.uploaded_at|date:"Y-m-d" }}</td>
          <td class="text-center">
            <a href="{% url 'resources:edit' r.id %}" class="btn btn-sm btn-outline-warning me-1">
              <i class="bx bx-edit-alt"></i>
            </a>
            <form method="post" action="{% url 'resources:delete' r.id %}" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="bx bx-trash"></i>
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-muted">No resources uploaded yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
