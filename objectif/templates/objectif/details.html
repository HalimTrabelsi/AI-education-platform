<!DOCTYPE html>
<html>
<head>
    <title>D√©tails - {{ details.titre }}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; line-height: 1.6; color: #333; background: #f8f9fa; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .header h1 { color: #2c3e50; margin-bottom: 10px; }
        .header .objective-id { color: #7f8c8d; font-size: 14px; }
        
        /* Layout principal */
        .main-layout { display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        
        /* Sections */
        .section { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .section h2 { color: #2c3e50; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #3498db; }
        
        /* Grid pour les informations */
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .info-item { padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db; }
        .info-item strong { display: block; color: #2c3e50; margin-bottom: 5px; }
        
        /* Barre de progression */
        .progress-container { margin: 15px 0; }
        .progress-bar { background: #ecf0f1; border-radius: 10px; height: 25px; overflow: hidden; position: relative; }
        .progress-fill { background: linear-gradient(45deg, #3498db, #2980b9); height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px; transition: width 0.3s ease; }
        .progress-text { position: absolute; width: 100%; text-align: center; font-weight: bold; color: #2c3e50; }
        
        /* Badges */
        .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin: 2px; }
        .badge-high { background: #e74c3c; color: white; }
        .badge-medium { background: #f39c12; color: white; }
        .badge-low { background: #27ae60; color: white; }
        .badge-success { background: #27ae60; color: white; }
        .badge-warning { background: #f39c12; color: white; }
        .badge-danger { background: #e74c3c; color: white; }
        .badge-info { background: #3498db; color: white; }
        
        /* QR Code */
        .qr-section { text-align: center; }
        .qr-code img { max-width: 200px; border: 1px solid #ddd; border-radius: 10px; padding: 10px; background: white; transition: transform 0.3s ease; }
        .qr-code img:hover { transform: scale(1.05); }
        
        /* Calendrier */
        .calendar-mini { background: white; border-radius: 10px; padding: 15px; }
        .calendar-event { padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 4px solid; }
        .event-deadline { border-left-color: #e74c3c; background: #fdedec; }
        .event-start { border-left-color: #27ae60; background: #eafaf1; }
        .event-warning { border-left-color: #f39c12; background: #fef9e7; }
        
        /* Timeline */
        .timeline { margin-top: 15px; }
        .timeline-item { display: flex; align-items: center; margin: 10px 0; }
        .timeline-dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        .timeline-deadline { background: #e74c3c; }
        .timeline-start { background: #27ae60; }
        .timeline-content { flex: 1; }
        
        /* Actions */
        .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; text-decoration: none; border-radius: 6px; font-weight: 500; transition: all 0.3s ease; border: none; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        
        /* Listes */
        .list-items { list-style: none; }
        .list-items li { padding: 8px 0; border-bottom: 1px solid #ecf0f1; display: flex; align-items: center; gap: 10px; }
        .list-items li:before { content: "‚Ä¢"; color: #3498db; font-weight: bold; }
        
        /* Alertes */
        .alert { padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid; }
        .alert-warning { background: #fef9e7; border-left-color: #f39c12; }
        .alert-danger { background: #fdedec; border-left-color: #e74c3c; }

        /* Section Analyse IA */
        .ia-section { border: 2px solid #17a2b8; background: linear-gradient(135deg, #f8fdff, #e8f4fd); }
        .ia-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px; }
        .ia-card { background: white; padding: 15px; border-radius: 8px; border-left: 4px solid; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .ia-card strong { display: block; margin-bottom: 8px; font-size: 14px; }
        .ia-card ul { margin: 0; padding-left: 20px; }
        .ia-card li { margin-bottom: 5px; font-size: 14px; }
        
        .points-forts { border-left-color: #27ae60; }
        .points-amelioration { border-left-color: #f39c12; }
        .risques { border-left-color: #e74c3c; }
        .recommendations { border-left-color: #3498db; }
        
        .ia-badge { font-size: 12px; padding: 3px 8px; border-radius: 12px; margin-left: 5px; }
        .ia-score { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; display: inline-block; margin: 5px 0; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-layout { grid-template-columns: 1fr; }
            .info-grid { grid-template-columns: 1fr; }
            .ia-grid { grid-template-columns: 1fr; }
            .actions { flex-direction: column; }
            .btn { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéØ {{ details.titre }}</h1>
         
            
            <!-- Alertes importantes -->
            {% if calendar_data.deadline_alert %}
            <div class="alert {% if calendar_data.deadline_alert.is_urgent %}alert-danger{% else %}alert-warning{% endif %}" style="margin-top: 15px;">
                <strong>{% if calendar_data.deadline_alert.is_urgent %}üö® URGENT{% else %}‚ö†Ô∏è Attention{% endif %}</strong><br>
                √âch√©ance dans {{ calendar_data.deadline_alert.days_left }} jour(s)
            </div>
            {% endif %}
        </div>

        <!-- Layout principal -->
        <div class="main-layout">
            <!-- Colonne principale -->
            <div class="main-content">
                <!-- Informations principales -->
                <div class="section">
                    <h2>üìä Informations principales</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Description</strong>
                            <div>{{ details.description }}</div>
                        </div>
                        <div class="info-item">
                            <strong>Fili√®re</strong>
                            <div>{{ details.filiere }}</div>
                        </div>
                        <div class="info-item">
                            <strong>Niveau</strong>
                            <div>{{ details.niveau }}</div>
                        </div>
                        <div class="info-item">
                            <strong>Priorit√©</strong>
                            <span class="badge {% if details.priorite == 'haute' %}badge-high{% elif details.priorite == 'moyenne' %}badge-medium{% else %}badge-low{% endif %}">
                                {{ details.priorite }}
                            </span>
                        </div>
                        <div class="info-item">
                            <strong>√âtat</strong>
                            <span class="badge {% if details.etat == 'termin√©' %}badge-success{% elif details.etat == 'en cours' %}badge-warning{% else %}badge-info{% endif %}">
                                {{ details.etat }}
                            </span>
                        </div>
                        <div class="info-item">
                            <strong>Score IA</strong>
                            <div>{{ details.score_priorite_ia }}</div>
                        </div>
                    </div>
                    
                    <!-- Barre de progression am√©lior√©e -->
                    <div class="progress-container">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                            <strong>Progression globale</strong>
                            <span style="font-weight: bold; color: #3498db;">{{ details.progression }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ details.progression }}%;"></div>
                            <div class="progress-text">{{ details.progression }}%</div>
                        </div>
                    </div>
                </div>

                <!-- SECTION ANALYSE IA -->
                {% if details.analyse_ia or details.suggestion_ia %}
                <div class="section ia-section">
                    <h2>ü§ñ Analyse Intelligence Artificielle</h2>
                    
                    <!-- Score de priorit√© IA -->
                    {% if details.score_priorite_ia %}
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div class="ia-score">
                            Score de priorit√© : {{ details.score_priorite_ia|floatformat:2 }}/1.0
                        </div>
                        {% if details.objectif_recommande %}
                        <span class="badge badge-success" style="font-size: 14px;">‚úÖ Recommand√©</span>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Analyse compl√®te -->
                    {% if details.analyse_ia %}
                    <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #17a2b8;">
                        <strong>üìã Analyse compl√®te :</strong>
                        <p style="margin-top: 8px; margin-bottom: 0;">{{ details.analyse_ia }}</p>
                    </div>
                    {% endif %}

                    <!-- Grille des analyses d√©taill√©es -->
                    <div class="ia-grid">
                        <!-- Points forts -->
                        {% if details.points_forts %}
                        <div class="ia-card points-forts">
                            <strong>‚úÖ Points forts</strong>
                            <ul>
                                {% for point in details.points_forts %}
                                <li>{{ point }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <!-- Points d'am√©lioration -->
                        {% if details.points_amelioration %}
                        <div class="ia-card points-amelioration">
                            <strong>üìà Points d'am√©lioration</strong>
                            <ul>
                                {% for point in details.points_amelioration %}
                                <li>{{ point }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <!-- Risques -->
                        {% if details.risques %}
                        <div class="ia-card risques">
                            <strong>‚ö†Ô∏è Risques identifi√©s</strong>
                            <ul>
                                {% for risque in details.risques %}
                                <li>{{ risque }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <!-- Recommandations -->
                        {% if details.recommendations %}
                        <div class="ia-card recommendations">
                            <strong>üí° Recommandations</strong>
                            <ul>
                                {% for reco in details.recommendations %}
                                <li>{{ reco }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>

                    <!-- √âvaluation des d√©lais et difficult√© -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        {% if details.delai_realisme %}
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <strong>üìÖ R√©alisme des d√©lais</strong>
                            <div style="margin-top: 8px;">
                                <span class="badge {% if details.delai_realisme == 'Tr√®s r√©aliste' %}badge-success{% elif details.delai_realisme == 'R√©aliste' %}badge-info{% elif details.delai_realisme == 'Peu r√©aliste' %}badge-warning{% else %}badge-danger{% endif %}">
                                    {{ details.delai_realisme }}
                                </span>
                            </div>
                        </div>
                        {% endif %}

                        {% if details.niveau_difficulte %}
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <strong>üéØ Niveau de difficult√©</strong>
                            <div style="margin-top: 8px;">
                                <span class="badge {% if details.niveau_difficulte == 'facile' %}badge-success{% elif details.niveau_difficulte == 'moyen' %}badge-info{% elif details.niveau_difficulte == 'difficile' %}badge-warning{% else %}badge-danger{% endif %}">
                                    {{ details.niveau_difficulte|title }}
                                </span>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Suggestion IA -->
                    {% if details.suggestion_ia and details.suggestion_ia != 'Aucune suggestion' %}
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #ffc107;">
                        <strong>üí¨ Suggestion imm√©diate :</strong>
                        <p style="margin-top: 8px; margin-bottom: 0;">{{ details.suggestion_ia }}</p>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <!-- Invitation √† l'analyse IA -->
                <div class="section" style="text-align: center; background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                    <h2>ü§ñ Analyse Intelligence Artificielle</h2>
                    <p style="color: #6c757d; margin-bottom: 20px;">Obtenez des insights intelligents sur votre objectif</p>
                    <a href="{% url 'objectifs:trigger_ia_analysis' objectif.id %}" class="btn btn-info" style="font-size: 16px;">
                        üöÄ Analyser avec l'IA
                    </a>
                </div>
                {% endif %}

                <!-- Calendrier et dates -->
                <div class="section">
                    <h2>üìÖ Calendrier et √©ch√©ances</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Date de cr√©ation</strong>
                            <div>{{ details.date_creation }}</div>
                        </div>
                        <div class="info-item">
                            <strong>Date de d√©but</strong>
                            <div>{{ details.date_debut }}</div>
                        </div>
                        <div class="info-item">
                            <strong>Date d'√©ch√©ance</strong>
                            <div>{{ details.date_echeance }}</div>
                        </div>
                        <div class="info-item">
                            <strong>Derni√®re mise √† jour</strong>
                            <div>{{ details.derniere_mise_a_jour }}</div>
                        </div>
                    </div>
                    
                    <!-- Timeline des √©v√©nements -->
                    <div class="timeline">
                        <h3 style="margin-bottom: 15px;">üïí Chronologie</h3>
                        {% for event in calendar_data.events %}
                        <div class="timeline-item">
                            <div class="timeline-dot timeline-{{ event.type }}"></div>
                            <div class="timeline-content">
                                <strong>{{ event.title }}</strong>
                                <div style="font-size: 14px; color: #7f8c8d;">
                                    {{ event.date }} - {{ event.description }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Statistiques et suivi -->
                <div class="section">
                    <h2>üìà Statistiques de suivi</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Sessions r√©alis√©es</strong>
                            <div style="font-size: 24px; font-weight: bold; color: #3498db;">{{ details.nb_sessions }}</div>
                        </div>
                        <div class="info-item">
                            <strong>Temps total investi</strong>
                            <div style="font-size: 24px; font-weight: bold; color: #27ae60;">{{ details.temps_total }}h</div>
                        </div>
                        <div class="info-item">
                            <strong>Recommand√© par IA</strong>
                            <span class="badge {% if details.objectif_recommande %}badge-success{% else %}badge-warning{% endif %}" style="font-size: 14px;">
                                {% if details.objectif_recommande %}‚úÖ Oui{% else %}‚ùå Non{% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <strong>Efficacit√©</strong>
                            <div style="font-size: 24px; font-weight: bold; color: #f39c12;">
                                {% if details.temps_total > 0 %}
                                    {{ details.progression|floatformat:1 }}%/h
                                {% else %}
                                    N/A
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenu dynamique -->
                {% if details.taches %}
                <div class="section">
                    <h2>‚úÖ T√¢ches √† r√©aliser</h2>
                    <ul class="list-items">
                        {% for tache in details.taches %}
                        <li>
                            <span>{{ tache }}</span>
                            <small style="margin-left: auto; color: #7f8c8d; font-size: 12px;">
                                {% cycle '‚è≥' 'üìù' 'üîç' '‚úÖ' 'üöÄ' %}
                            </small>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if details.ressources %}
                <div class="section">
                    <h2>üìö Ressources disponibles</h2>
                    <ul class="list-items">
                        {% for ressource in details.ressources %}
                        <li>
                            <span>{{ ressource }}</span>
                            <small style="margin-left: auto; color: #7f8c8d; font-size: 12px;">
                                {% cycle 'üìñ' 'üé•' 'üîó' 'üìä' 'üí°' %}
                            </small>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if details.tags %}
                <div class="section">
                    <h2>üè∑Ô∏è Tags et cat√©gories</h2>
                    <div>
                        {% for tag in details.tags %}
                        <span class="badge badge-info" style="font-size: 14px; margin: 5px;">{{ tag }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- QR Code -->
                <div class="section qr-section">
                    <h2>üì± QR Code</h2>
                    <div class="qr-code">
                        <img src="{% url 'objectifs:generate_qrcode' objectif.id %}" alt="QR Code pour {{ details.titre }}">
                        <p style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                            Scannez pour partager cet objectif
                        </p>
                    </div>
                </div>

                <!-- Actions rapides -->
               <!-- Dans la section "Actions rapides" de votre sidebar, ajoutez : -->
<div class="section">
    <h2>‚ö° Actions rapides</h2>
    <div class="actions" style="flex-direction: column;">
        <a href="{% url 'objectif:list' %}" class="btn btn-primary">
            üìã Liste des objectifs
        </a>
        <a href="{% url 'objectif:update' objectif.id %}" class="btn btn-warning">
            ‚úèÔ∏è Modifier l'objectif
        </a>
        
       
       <a href="{% url 'objectif:generate_pdf_bilan' objectif.id %}" 
class="btn btn-info"           style="display: inline-flex; align-items: center; justify-content: center; gap: 8px;">
            <span style="font-size: 18px;">üìä</span>
            <span>T√©l√©charger Bilan PDF</span>
        </a>

     
        
        <a href="{% url 'objectif:generate_qrcode' objectif.id %}" class="btn btn-info" download>
            üì± T√©l√©charger QR Code
        </a>
        <a href="{% url 'objectif:objective_json' objectif.id %}" class="btn btn-success" target="_blank">
            üìÑ Donn√©es JSON
        </a>
        <a href="{% url 'objectif:calendar' %}" class="btn btn-primary">
            üóìÔ∏è Voir calendrier
        </a>
        
        <!-- Statistiques rapides pour le PDF -->
        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
            <small style="color: #6c757d;">
                <strong>üìà Stats pour le PDF:</strong><br>
                ‚Ä¢ Progression: {{ details.progression }}%<br>
                ‚Ä¢ Sessions: {{ details.nb_sessions }}<br>
                ‚Ä¢ Temps: {{ details.temps_total }}h
            </small>
        </div>
    </div>
</div>

                <!-- M√©triques rapides -->
                <div class="section">
                    <h2>üìä M√©triques</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 20px; font-weight: bold; color: #3498db;">{{ details.progression }}%</div>
                            <div style="font-size: 12px; color: #7f8c8d;">Progression</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 20px; font-weight: bold; color: #27ae60;">{{ details.nb_sessions }}</div>
                            <div style="font-size: 12px; color: #7f8c8d;">Sessions</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 20px; font-weight: bold; color: #f39c12;">{{ details.temps_total }}h</div>
                            <div style="font-size: 12px; color: #7f8c8d;">Temps</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 20px; font-weight: bold; color: #e74c3c;">{{ calendar_data.deadline_alert.days_left|default:"-" }}</div>
                            <div style="font-size: 12px; color: #7f8c8d;">Jours restants</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Animation simple pour la barre de progression
        document.addEventListener('DOMContentLoaded', function() {
            const progressFill = document.querySelector('.progress-fill');
            if (progressFill) {
                // D√©clencher l'animation apr√®s un d√©lai
                setTimeout(() => {
                    progressFill.style.transition = 'width 1s ease-in-out';
                }, 500);
            }

            // Ajouter un effet de copie pour le QR Code
            const qrCode = document.querySelector('.qr-code img');
            if (qrCode) {
                qrCode.addEventListener('click', function() {
                    const tempInput = document.createElement('input');
                    tempInput.value = window.location.href;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    
                    // Feedback visuel
                    const originalSrc = qrCode.src;
                    qrCode.style.filter = 'brightness(0.8)';
                    setTimeout(() => {
                        qrCode.style.filter = '';
                    }, 300);
                });
            }
        });
    </script>
</body>
</html>